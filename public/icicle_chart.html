<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Icicle Chart</title>
    <script src="https://cdn.plot.ly/plotly-2.20.0.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div id="icicle-container" style="width: 100%; height: 700px;"></div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        d3.json("transformed_data.json").then(function (data) {
            const labels = [];
            const parents = [];
            const values = [];
            const descriptions = [];
            const colors = []; // Array to store colors for each node

            // Define a color palette
            const colorPalette = [
                "#a64036", "#354e6b", "#4181a4", "#f0c2a2", "#3D5C6F", 
                "#E47159", "#F9AE78", "#313772", "#478ECC", "#75B5BC", "#326DB6","#BB3E2D","#4A5664","#666871","#88A5D2","#084594","#1F78B4","#A6CEE3","#D8EAF3","#9ECAE1","#C6DBEF","#DEEBF7","#F7FBFF"
            ];

            // Helper function to get a color from the palette
            function getColor(index) {
                return colorPalette[index % colorPalette.length];
            }

            // Process the data
            data.forEach((row, index) => {
                const category1 = row["Category-1"];
                const category2 = row["Category-2"];
                const category3 = row["Category-3"];
                const category4 = row["Category-4"];
                const link = row["Link"]; // Added for links

                function addNode(label, parent, value, description, color) {
                    if (!labels.includes(label)) {
                        labels.push(label);
                        parents.push(parent || "");
                        values.push(value || 0);
                        descriptions.push(description || "");
                        colors.push(color || getColor(labels.length)); // Assign color
                    }
                }

                // Add nodes and assign colors
                addNode(category1, "", 0, "", getColor(16)); // Root node
                if (category2) addNode(category2, category1, 0, "", getColor(17));
                if (category3) {
                    // Construct description for Category-3 with Category-4 and Link
                    let desc = `<span style="font-size: 20px; font-weight: bold;">${category3}</span>`; // Increase Category-3 font size
                    if (category4) {
                        const hyperlink = link
                            ? `<a href="${link}" target="_blank" style="color: inherit; text-decoration: none; font-style: italic; font-size: 18px;">${category4}</a>`
                            : `<span style="font-style: italic; font-size: 18px;">${category4}</span>`;
                        desc += `<br><br>${hyperlink}`; // Added extra space and italics
                    }
                    addNode(category3, category2, 1, desc, getColor(18));
                }
            });


            // Plot the treemap
            const plotData = [
                {
                    type: "treemap",
                    labels: labels,
                    parents: parents,
                    values: values,
                    textinfo: "text",
                    text: descriptions,
                    hoverinfo: "text",
                    pathbar: { visible: true },
                    marker: {
                        colors: colors // Apply colors to the chart
                    }
                }
            ];

            const layout = {
                margin: { t: 50, l: 25, r: 25, b: 25 },
                font: { size: 20 }, // Adjust font size for better visibility
            };

            Plotly.newPlot("icicle-container", plotData, layout);
        }).catch(function (error) {
            console.error("Error loading the JSON file:", error);
        });
    });
</script>

</body>
</html>
